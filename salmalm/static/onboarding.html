<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SalmAlm â€” Setup Wizard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f5f5f7;color:#1a1a1a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.wizard{background:#ffffff;padding:40px;border:1px solid #e0e0e0;max-width:560px;width:100%;position:relative;overflow:hidden}
h1{color:#a78bfa;margin-bottom:4px;font-size:26px}
h2{color:#c4b5fd;font-size:20px;margin-bottom:8px}
.sub{color:#666;font-size:13px;margin-bottom:24px;line-height:1.6}
.step{display:none}
.step.active{display:block}
.step label{display:block;font-size:13px;color:#888;margin-bottom:6px;font-weight:500}
.step input,.step select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #ddd;background:#f5f5f7;color:#1a1a1a;font-size:14px;font-family:monospace}
.step input:focus,.step select:focus{border-color:#7c5cfc;outline:none}
.step .hint{font-size:11px;color:#666;margin-top:4px}
.field{margin-bottom:16px}
.required::after{content:" *";color:#f87171}
.divider{border:1px solid #e0e0e0;margin:20px 0}
.btn-row{display:flex;gap:12px;margin-top:24px}
button{padding:14px 24px;border-radius:8px;border:none;font-size:15px;cursor:pointer;font-weight:500;transition:all .2s}
.btn-primary{background:#4f46e5;color:#fff;flex:1}
.btn-primary:hover{background:#4338ca}
.btn-secondary{background:#2a2d37;color:#888;padding:14px 20px}
.btn-secondary:hover{background:#ddd;color:#1a1a1a}
button:disabled{opacity:0.5;cursor:not-allowed}
.result{margin-top:16px;padding:12px;border-radius:8px;font-size:14px;display:none}
.result.ok{background:#0f2a1f;border:1px solid #34d399;color:#34d399;display:block}
.result.err{background:#2a0f0f;border:1px solid #f87171;color:#f87171;display:block}
.progress{display:flex;gap:8px;margin-bottom:28px;justify-content:center}
.progress .dot{width:10px;height:10px;border-radius:50%;background:#ddd;transition:all .3s}
.progress .dot.active{background:#7c5cfc;transform:scale(1.2)}
.progress .dot.done{background:#34d399}
.welcome-emoji{font-size:64px;text-align:center;margin:20px 0}
.welcome-text{text-align:center;font-size:18px;color:#444;line-height:1.6;margin-bottom:24px}
.persona-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px}
.persona-card{padding:16px 12px;border-radius:12px;border:2px solid #ddd;background:#f5f5f7;cursor:pointer;text-align:center;transition:all .2s}
.persona-card:hover{border-color:#7c5cfc;background:#f0ecff}
.persona-card.selected{border-color:#7c5cfc;background:#f0ecff}
.persona-card .emoji{font-size:32px;margin-bottom:8px}
.persona-card .name{font-size:14px;font-weight:600;color:#1a1a1a;margin-bottom:4px}
.persona-card .desc{font-size:11px;color:#666}
.model-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;border:1px solid #ddd;background:#f5f5f7;cursor:pointer;margin-bottom:8px;transition:all .2s}
.model-option:hover{border-color:#7c5cfc}
.model-option.selected{border-color:#7c5cfc;background:#f0ecff}
.model-option .radio{width:18px;height:18px;border-radius:50%;border:2px solid #555;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.model-option.selected .radio{border-color:#7c5cfc}
.model-option.selected .radio::after{content:'';width:10px;height:10px;border-radius:50%;background:#7c5cfc}
.model-option .info{flex:1}
.model-option .mname{font-size:14px;font-weight:500}
.model-option .mdesc{font-size:11px;color:#666}
.complete-box{text-align:center;padding:20px 0}
.complete-emoji{font-size:72px;margin-bottom:16px}
.complete-title{font-size:24px;color:#34d399;font-weight:600;margin-bottom:8px}
.complete-sub{font-size:14px;color:#666;margin-bottom:24px}
.test-status{font-size:13px;color:#666;margin-top:8px}
.test-status.testing{color:#fbbf24}
.test-status.success{color:#34d399}
.test-status.fail{color:#f87171}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.step.active{animation:fadeIn .3s ease}
</style></head><body>
<div class="wizard">
<div class="progress" id="progress">
  <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
</div>

<!-- Step 0: Welcome -->
<div class="step active" id="step-0">
  <div class="welcome-emoji">ğŸ‰</div>
  <h1 style="text-align:center">Welcome to SalmAlm!</h1>
  <div class="welcome-text">
    Your personal AI gateway is ready.<br>
    Let's get you set up in 4 quick steps.
  </div>
  <div class="btn-row"><button class="btn-primary" onclick="goStep(1)">Let's Go! â†’</button></div>
</div>

<!-- Step 1: API Keys -->
<div class="step" id="step-1">
  <h2>ğŸ”‘ API Keys</h2>
  <p class="sub">Enter at least one API key to connect to an AI provider.</p>
  <div class="field">
    <label class="required">Anthropic API Key (Claude)</label>
    <input type="password" id="anthropic" placeholder="sk-ant-...">
    <div class="hint">Recommended â€” Best for most tasks. <a href="https://console.anthropic.com/settings/keys" target="_blank" style="color:#7c5cfc">Get Key â†’</a></div>
  </div>
  <div class="field">
    <label>OpenAI API Key (GPT)</label>
    <input type="password" id="openai" placeholder="sk-...">
    <div class="hint"><a href="https://platform.openai.com/api-keys" target="_blank" style="color:#7c5cfc">Get Key â†’</a></div>
  </div>
  <div class="field">
    <label>Google API Key (Gemini)</label>
    <input type="password" id="google" placeholder="AIza...">
    <div class="hint"><a href="https://aistudio.google.com/apikey" target="_blank" style="color:#7c5cfc">Get Key â†’</a></div>
  </div>
  <div class="divider"></div>
  <div class="field">
    <label>ğŸ¦™ Ollama URL (Local â€” no key needed)</label>
    <input type="text" id="ollama" placeholder="http://localhost:11434/v1">
    <div class="hint">Free local AI. <a href="https://ollama.com" target="_blank" style="color:#7c5cfc">Install â†’</a></div>
  </div>
  <div class="btn-row">
    <button class="btn-secondary" onclick="goStep(0)">â† Back</button>
    <button class="btn-primary" onclick="goStep(2)">Next â†’</button>
  </div>
</div>

<!-- Step 2: Model Selection + Test -->
<div class="step" id="step-2">
  <h2>ğŸ¤– Default Model</h2>
  <p class="sub">Pick your preferred AI model. You can change anytime with <code>/model</code>.</p>
  <div id="model-list">
    <div class="model-option selected" data-model="auto" onclick="pickModel(this)">
      <div class="radio"></div>
      <div class="info"><div class="mname">ğŸ¯ Auto (Recommended)</div><div class="mdesc">Smart routing â€” picks the best model per task</div></div>
    </div>
    <div class="model-option" data-model="anthropic/claude-sonnet-4-6" onclick="pickModel(this)">
      <div class="radio"></div>
      <div class="info"><div class="mname">Claude Sonnet 4.6</div><div class="mdesc">Fast & capable â€” best balance of speed and quality</div></div>
    </div>
    <div class="model-option" data-model="anthropic/claude-opus-4-6" onclick="pickModel(this)">
      <div class="radio"></div>
      <div class="info"><div class="mname">Claude Opus 4.6</div><div class="mdesc">Most capable â€” complex reasoning & analysis</div></div>
    </div>
    <div class="model-option" data-model="openai/gpt-5.2-codex" onclick="pickModel(this)">
      <div class="radio"></div>
      <div class="info"><div class="mname">GPT-5.2 Codex</div><div class="mdesc">OpenAI's latest coding model</div></div>
    </div>
    <div class="model-option" data-model="google/gemini-2.5-pro" onclick="pickModel(this)">
      <div class="radio"></div>
      <div class="info"><div class="mname">Gemini 2.5 Pro</div><div class="mdesc">Google's most advanced model</div></div>
    </div>
  </div>
  <div class="test-status" id="test-status"></div>
  <div class="btn-row">
    <button class="btn-secondary" onclick="goStep(1)">â† Back</button>
    <button class="btn-primary" id="btn-test" onclick="testAndNext()">Test Connection & Next â†’</button>
  </div>
</div>

<!-- Step 3: Persona -->
<div class="step" id="step-3">
  <h2>ğŸ­ AI Personality</h2>
  <p class="sub">Choose a base personality for your AI. Customize later via SOUL.md.</p>
  <div class="persona-grid">
    <div class="persona-card selected" data-persona="expert" onclick="pickPersona(this)">
      <div class="emoji">ğŸ§‘â€ğŸ’¼</div>
      <div class="name">Expert</div>
      <div class="desc">Professional, precise, detail-oriented</div>
    </div>
    <div class="persona-card" data-persona="friend" onclick="pickPersona(this)">
      <div class="emoji">ğŸ˜„</div>
      <div class="name">Friend</div>
      <div class="desc">Casual, warm, conversational</div>
    </div>
    <div class="persona-card" data-persona="assistant" onclick="pickPersona(this)">
      <div class="emoji">ğŸ¤–</div>
      <div class="name">Assistant</div>
      <div class="desc">Efficient, concise, task-focused</div>
    </div>
  </div>
  <div class="btn-row">
    <button class="btn-secondary" onclick="goStep(2)">â† Back</button>
    <button class="btn-primary" onclick="finishSetup()">Complete Setup â†’</button>
  </div>
</div>

<!-- Step 4: Complete -->
<div class="step" id="step-4">
  <div class="complete-box">
    <div class="complete-emoji">ğŸš€</div>
    <div class="complete-title">Setup Complete!</div>
    <div class="complete-sub">Your AI gateway is ready. Redirecting to chat...</div>
  </div>
</div>

<div class="result" id="result"></div>
</div>

<script>
let currentStep=0, selectedModel='auto', selectedPersona='expert';

function goStep(n){
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  document.getElementById('step-'+n).classList.add('active');
  const dots=document.querySelectorAll('.progress .dot');
  dots.forEach((d,i)=>{d.className='dot';if(i<n)d.classList.add('done');if(i===n)d.classList.add('active');});
  currentStep=n;
}

function pickModel(el){
  document.querySelectorAll('.model-option').forEach(m=>m.classList.remove('selected'));
  el.classList.add('selected');
  selectedModel=el.dataset.model;
}

function pickPersona(el){
  document.querySelectorAll('.persona-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPersona=el.dataset.persona;
}

function getKeys(){
  const body={};
  ['anthropic','openai','google'].forEach(k=>{
    const v=document.getElementById(k).value.trim();
    if(v) body[k+'_api_key']=v;
  });
  const ollama=document.getElementById('ollama').value.trim();
  if(ollama) body.ollama_url=ollama;
  return body;
}

async function testAndNext(){
  const btn=document.getElementById('btn-test');
  const status=document.getElementById('test-status');
  const keys=getKeys();
  if(!Object.keys(keys).length){
    status.textContent='âš ï¸ Please enter at least one API key first (Step 2)';
    status.className='test-status fail';
    return;
  }
  btn.disabled=true;
  status.textContent='ğŸ”„ Testing connection...';
  status.className='test-status testing';
  try{
    const r=await fetch('/api/onboarding',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(keys)});
    const d=await r.json();
    if(d.ok){
      const isTestFail=d.test_result&&d.test_result.includes('fail');
      if(!isTestFail){
        status.textContent='âœ… Connection successful! ('+d.saved.join(', ')+' saved)';
        status.className='test-status success';
        setTimeout(()=>goStep(3),1000);
      }else{
        status.textContent='âš ï¸ Keys saved but test failed â€” check your keys';
        status.className='test-status fail';
      }
    }else{
      status.textContent='âŒ '+d.error;
      status.className='test-status fail';
    }
  }catch(e){
    status.textContent='âŒ Network error: '+e;
    status.className='test-status fail';
  }
  btn.disabled=false;
}

async function finishSetup(){
  // Save model preference and persona
  try{
    const body={model:selectedModel,persona:selectedPersona};
    await fetch('/api/onboarding/preferences',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  }catch(e){/* best effort */}
  goStep(4);
  setTimeout(()=>location.reload(),2500);
}

// i18n
const _lang=localStorage.getItem('salmalm-lang')||'en';
if(_lang==='ko'){
  document.querySelector('#step-0 h1').textContent='ì‚¶ì•ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!';
  document.querySelector('#step-0 .welcome-text').innerHTML='ê°œì¸ AI ê²Œì´íŠ¸ì›¨ì´ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.<br>4ë‹¨ê³„ë¡œ ë¹ ë¥´ê²Œ ì„¤ì •í•´ ë´…ì‹œë‹¤.';
  document.querySelector('#step-0 button').textContent='ì‹œì‘í•˜ê¸°! â†’';
  document.querySelector('#step-1 h2').textContent='ğŸ”‘ API í‚¤';
  document.querySelector('#step-1 .sub').textContent='AI ì œê³µìì— ì—°ê²°í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
  document.querySelector('#step-2 h2').textContent='ğŸ¤– ê¸°ë³¸ ëª¨ë¸';
  document.querySelector('#step-2 .sub').innerHTML='ì„ í˜¸í•˜ëŠ” AI ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”. <code>/model</code>ë¡œ ì–¸ì œë“  ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
  document.querySelector('#step-3 h2').textContent='ğŸ­ AI ì„±ê²©';
  document.querySelector('#step-3 .sub').textContent='AIì˜ ê¸°ë³¸ ì„±ê²©ì„ ì„ íƒí•˜ì„¸ìš”. SOUL.mdì—ì„œ ë‚˜ì¤‘ì— ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
  document.querySelectorAll('.persona-card')[0].querySelector('.name').textContent='ì „ë¬¸ê°€';
  document.querySelectorAll('.persona-card')[0].querySelector('.desc').textContent='ì „ë¬¸ì ì´ê³  ì •í™•í•˜ë©° ë””í…Œì¼ ì¤‘ì‹¬';
  document.querySelectorAll('.persona-card')[1].querySelector('.name').textContent='ì¹œêµ¬';
  document.querySelectorAll('.persona-card')[1].querySelector('.desc').textContent='ìºì£¼ì–¼í•˜ê³  ë”°ëœ»í•œ ëŒ€í™” ìŠ¤íƒ€ì¼';
  document.querySelectorAll('.persona-card')[2].querySelector('.name').textContent='ë¹„ì„œ';
  document.querySelectorAll('.persona-card')[2].querySelector('.desc').textContent='íš¨ìœ¨ì ì´ê³  ê°„ê²°í•˜ë©° ì‘ì—… ì¤‘ì‹¬';
  document.querySelector('.complete-title').textContent='ì„¤ì • ì™„ë£Œ!';
  document.querySelector('.complete-sub').textContent='AI ê²Œì´íŠ¸ì›¨ì´ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì±„íŒ…ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...';
}
</script></body></html>