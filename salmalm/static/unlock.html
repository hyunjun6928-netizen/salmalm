<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SalmAlm â€” Unlock</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:#f5f5f7;color:#1a1a1a;height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:#ffffff;padding:40px;border:1px solid #e0e0e0;text-align:center;min-width:320px}
h1{color:#a78bfa;margin-bottom:8px}
p{color:#666;margin-bottom:24px;font-size:14px}
input{width:100%;padding:12px;border-radius:8px;border:1px solid #ddd;background:#f5f5f7;color:#1a1a1a;font-size:16px;margin-bottom:16px;text-align:center}
button{width:100%;padding:12px;border-radius:8px;border:none;background:#4f46e5;color:#fff;font-size:16px;cursor:pointer}
button:hover{background:#4338ca}
.error{color:#ef4444;margin-top:12px;font-size:14px;display:none}
</style></head><body>
<div class="card">
<h1>ğŸ˜ˆ SalmAlm</h1>
<p>Personal AI Gateway {{VERSION}}</p>
<div id="login-mode" style="display:none;margin-bottom:16px">
<input type="text" id="login-user" placeholder="Username" style="margin-bottom:8px">
<input type="password" id="login-pw" placeholder="Password">
<button id="login-btn" style="margin-top:8px">Login</button>
<div style="margin-top:8px"><a href="#" id="back-vault-link" style="color:#a78bfa;font-size:13px">â† Vault unlock</a></div>
</div>
<div id="vault-mode">
<input type="password" id="pw" placeholder="Master password" data-enter-action="unlock">
<button data-action="unlock" id="unlock-btn">Unlock</button>
<div style="margin-top:8px"><a href="#" id="to-login-link" style="color:#a78bfa;font-size:13px">User login â†’</a></div>
</div>
<div class="error" id="err"></div>
<div id="unlock-help" style="margin-top:24px;font-size:13px;color:#999;line-height:1.8;text-align:left;max-width:400px"></div>
<script>
(function(){
  var L=localStorage.getItem('salmalm-lang')||'en';
  var h=L==='ko'?
    '<p style="color:#bbb;font-weight:600;margin-bottom:8px">ğŸ”‘ ì²˜ìŒì´ì‹ ê°€ìš”?</p><p>ì„œë²„ë¥¼ ì‹œì‘í•  ë•Œ ì„¤ì •í•œ ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p><p style="margin-top:12px;color:#bbb;font-weight:600">ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë¥´ê² ë‹¤ë©´:</p><p>ì„œë²„ë¥¼ ì‹¤í–‰í•œ <b>cmd/í„°ë¯¸ë„ ì°½</b>ì„ í™•ì¸í•˜ì„¸ìš”.</p><code style="display:block;background:#252838;padding:8px 12px;border-radius:6px;font-size:12px;color:#7c83ff;margin:8px 0">Password: salmalm_local</code><p style="margin-top:12px;color:#bbb;font-weight:600">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‹¤ë©´:</p><p>vaultë¥¼ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”:</p><code style="display:block;background:#252838;padding:6px 10px;border-radius:4px;font-size:11px;color:#888;margin:4px 0">del %USERPROFILE%\\.salmalm\\vault.enc</code><span style="font-size:11px;color:#666">(Linux/Mac: rm ~/.salmalm/vault.enc)</span>':
    '<p style="color:#bbb;font-weight:600;margin-bottom:8px">ğŸ”‘ First time?</p><p>Enter the master password you set when starting the server.</p><p style="margin-top:12px;color:#bbb;font-weight:600">Don\x27t know the password?</p><p>Check the <b>cmd/terminal window</b> where you started the server.</p><code style="display:block;background:#252838;padding:8px 12px;border-radius:6px;font-size:12px;color:#7c83ff;margin:8px 0">Password: salmalm_local</code><p style="margin-top:12px;color:#bbb;font-weight:600">Forgot your password?</p><p>Reset the vault and restart:</p><code style="display:block;background:#252838;padding:6px 10px;border-radius:4px;font-size:11px;color:#888;margin:4px 0">del %USERPROFILE%\\.salmalm\\vault.enc</code><span style="font-size:11px;color:#666">(Linux/Mac: rm ~/.salmalm/vault.enc)</span>';
  document.getElementById('unlock-help').innerHTML=h;
})();
</script>
</div>
<script>
function toggleLoginMode(showLogin){
  document.getElementById('login-mode').style.display=showLogin?'block':'none';
  document.getElementById('vault-mode').style.display=showLogin?'none':'block';
}
async function loginUser(){
  var u=document.getElementById('login-user').value,p=document.getElementById('login-pw').value;
  var r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  var d=await r.json();
  if(d.ok){sessionStorage.setItem('tok',d.token||'');localStorage.setItem('salm_token',d.token||'');location.reload()}
  else{var e=document.getElementById('err');e.textContent=d.error||'Login failed';e.style.display='block'}
}
document.getElementById('login-user').addEventListener('keydown',function(e){if(e.key==='Enter')document.getElementById('login-pw').focus()});
document.getElementById('login-pw').addEventListener('keydown',function(e){if(e.key==='Enter')loginUser()});
document.getElementById('pw').addEventListener('keydown',function(e){if(e.key==='Enter')unlock()});
async function unlock(){
  const pw=document.getElementById('pw').value;
  const r=await fetch('/api/unlock',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pw})});
  const d=await r.json();
  if(d.ok){sessionStorage.setItem('tok',d.token||'');location.reload()}
  else{const e=document.getElementById('err');e.textContent=d.error;e.style.display='block'}
}
document.getElementById('unlock-btn').addEventListener('click',()=>unlock());
document.getElementById('login-btn').addEventListener('click',()=>loginUser());
document.getElementById('to-login-link').addEventListener('click',(e)=>{e.preventDefault();toggleLoginMode(true)});
document.getElementById('back-vault-link').addEventListener('click',(e)=>{e.preventDefault();toggleLoginMode(false)});
</script></body></html>